/**
 * @author Toru Nagashima
 * See LICENSE file in root directory for full license.
 */
"use strict"

const ***REMOVED*** ReferenceTracker ***REMOVED*** = require("eslint-utils")

/**
 * Verifier for `prefer-global/*` rules.
 */
class Verifier ***REMOVED***
    /**
     * Initialize this instance.
     * @param ***REMOVED***RuleContext***REMOVED*** context The rule context to report.
     * @param ***REMOVED******REMOVED***modules:object,globals:object***REMOVED******REMOVED*** trackMap The track map.
     */
    constructor(context, trackMap) ***REMOVED***
        this.context = context
        this.trackMap = trackMap
        this.verify =
            context.options[0] === "never"
                ? this.verifyToPreferModules
                : this.verifyToPreferGlobals
    ***REMOVED***

    /**
     * Verify the code to suggest the use of globals.
     * @returns ***REMOVED***void***REMOVED***
     */
    verifyToPreferGlobals() ***REMOVED***
        const ***REMOVED*** context, trackMap ***REMOVED*** = this
        const tracker = new ReferenceTracker(context.getScope(), ***REMOVED***
            mode: "legacy",
        ***REMOVED***)

        for (const ***REMOVED*** node ***REMOVED*** of [
            ...tracker.iterateCjsReferences(trackMap.modules),
            ...tracker.iterateEsmReferences(trackMap.modules),
        ]) ***REMOVED***
            context.report(***REMOVED*** node, messageId: "preferGlobal" ***REMOVED***)
        ***REMOVED***
    ***REMOVED***

    /**
     * Verify the code to suggest the use of modules.
     * @returns ***REMOVED***void***REMOVED***
     */
    verifyToPreferModules() ***REMOVED***
        const ***REMOVED*** context, trackMap ***REMOVED*** = this
        const tracker = new ReferenceTracker(context.getScope())

        for (const ***REMOVED*** node ***REMOVED*** of tracker.iterateGlobalReferences(
            trackMap.globals
        )) ***REMOVED***
            context.report(***REMOVED*** node, messageId: "preferModule" ***REMOVED***)
        ***REMOVED***
    ***REMOVED***
***REMOVED***

module.exports = function checkForPreferGlobal(context, trackMap) ***REMOVED***
    new Verifier(context, trackMap).verify()
***REMOVED***
