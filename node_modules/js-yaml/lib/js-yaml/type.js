'use strict';

var YAMLException = require('./exception');

var TYPE_CONSTRUCTOR_OPTIONS = [
  'kind',
  'resolve',
  'construct',
  'instanceOf',
  'predicate',
  'represent',
  'defaultStyle',
  'styleAliases'
];

var YAML_NODE_KINDS = [
  'scalar',
  'sequence',
  'mapping'
];

function compileStyleAliases(map) ***REMOVED***
  var result = ***REMOVED******REMOVED***;

  if (map !== null) ***REMOVED***
    Object.keys(map).forEach(function (style) ***REMOVED***
      map[style].forEach(function (alias) ***REMOVED***
        result[String(alias)] = style;
      ***REMOVED***);
    ***REMOVED***);
  ***REMOVED***

  return result;
***REMOVED***

function Type(tag, options) ***REMOVED***
  options = options || ***REMOVED******REMOVED***;

  Object.keys(options).forEach(function (name) ***REMOVED***
    if (TYPE_CONSTRUCTOR_OPTIONS.indexOf(name) === -1) ***REMOVED***
      throw new YAMLException('Unknown option "' + name + '" is met in definition of "' + tag + '" YAML type.');
    ***REMOVED***
  ***REMOVED***);

  // TODO: Add tag format check.
  this.tag          = tag;
  this.kind         = options['kind']         || null;
  this.resolve      = options['resolve']      || function () ***REMOVED*** return true; ***REMOVED***;
  this.construct    = options['construct']    || function (data) ***REMOVED*** return data; ***REMOVED***;
  this.instanceOf   = options['instanceOf']   || null;
  this.predicate    = options['predicate']    || null;
  this.represent    = options['represent']    || null;
  this.defaultStyle = options['defaultStyle'] || null;
  this.styleAliases = compileStyleAliases(options['styleAliases'] || null);

  if (YAML_NODE_KINDS.indexOf(this.kind) === -1) ***REMOVED***
    throw new YAMLException('Unknown kind "' + this.kind + '" is specified for "' + tag + '" YAML type.');
  ***REMOVED***
***REMOVED***

module.exports = Type;
