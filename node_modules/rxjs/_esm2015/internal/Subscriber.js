import ***REMOVED*** isFunction ***REMOVED*** from './util/isFunction';
import ***REMOVED*** empty as emptyObserver ***REMOVED*** from './Observer';
import ***REMOVED*** Subscription ***REMOVED*** from './Subscription';
import ***REMOVED*** rxSubscriber as rxSubscriberSymbol ***REMOVED*** from '../internal/symbol/rxSubscriber';
import ***REMOVED*** config ***REMOVED*** from './config';
import ***REMOVED*** hostReportError ***REMOVED*** from './util/hostReportError';
export class Subscriber extends Subscription ***REMOVED***
    constructor(destinationOrNext, error, complete) ***REMOVED***
        super();
        this.syncErrorValue = null;
        this.syncErrorThrown = false;
        this.syncErrorThrowable = false;
        this.isStopped = false;
        switch (arguments.length) ***REMOVED***
            case 0:
                this.destination = emptyObserver;
                break;
            case 1:
                if (!destinationOrNext) ***REMOVED***
                    this.destination = emptyObserver;
                    break;
                ***REMOVED***
                if (typeof destinationOrNext === 'object') ***REMOVED***
                    if (destinationOrNext instanceof Subscriber) ***REMOVED***
                        this.syncErrorThrowable = destinationOrNext.syncErrorThrowable;
                        this.destination = destinationOrNext;
                        destinationOrNext.add(this);
                    ***REMOVED***
                    else ***REMOVED***
                        this.syncErrorThrowable = true;
                        this.destination = new SafeSubscriber(this, destinationOrNext);
                    ***REMOVED***
                    break;
                ***REMOVED***
            default:
                this.syncErrorThrowable = true;
                this.destination = new SafeSubscriber(this, destinationOrNext, error, complete);
                break;
        ***REMOVED***
    ***REMOVED***
    [rxSubscriberSymbol]() ***REMOVED*** return this; ***REMOVED***
    static create(next, error, complete) ***REMOVED***
        const subscriber = new Subscriber(next, error, complete);
        subscriber.syncErrorThrowable = false;
        return subscriber;
    ***REMOVED***
    next(value) ***REMOVED***
        if (!this.isStopped) ***REMOVED***
            this._next(value);
        ***REMOVED***
    ***REMOVED***
    error(err) ***REMOVED***
        if (!this.isStopped) ***REMOVED***
            this.isStopped = true;
            this._error(err);
        ***REMOVED***
    ***REMOVED***
    complete() ***REMOVED***
        if (!this.isStopped) ***REMOVED***
            this.isStopped = true;
            this._complete();
        ***REMOVED***
    ***REMOVED***
    unsubscribe() ***REMOVED***
        if (this.closed) ***REMOVED***
            return;
        ***REMOVED***
        this.isStopped = true;
        super.unsubscribe();
    ***REMOVED***
    _next(value) ***REMOVED***
        this.destination.next(value);
    ***REMOVED***
    _error(err) ***REMOVED***
        this.destination.error(err);
        this.unsubscribe();
    ***REMOVED***
    _complete() ***REMOVED***
        this.destination.complete();
        this.unsubscribe();
    ***REMOVED***
    _unsubscribeAndRecycle() ***REMOVED***
        const ***REMOVED*** _parentOrParents ***REMOVED*** = this;
        this._parentOrParents = null;
        this.unsubscribe();
        this.closed = false;
        this.isStopped = false;
        this._parentOrParents = _parentOrParents;
        return this;
    ***REMOVED***
***REMOVED***
export class SafeSubscriber extends Subscriber ***REMOVED***
    constructor(_parentSubscriber, observerOrNext, error, complete) ***REMOVED***
        super();
        this._parentSubscriber = _parentSubscriber;
        let next;
        let context = this;
        if (isFunction(observerOrNext)) ***REMOVED***
            next = observerOrNext;
        ***REMOVED***
        else if (observerOrNext) ***REMOVED***
            next = observerOrNext.next;
            error = observerOrNext.error;
            complete = observerOrNext.complete;
            if (observerOrNext !== emptyObserver) ***REMOVED***
                context = Object.create(observerOrNext);
                if (isFunction(context.unsubscribe)) ***REMOVED***
                    this.add(context.unsubscribe.bind(context));
                ***REMOVED***
                context.unsubscribe = this.unsubscribe.bind(this);
            ***REMOVED***
        ***REMOVED***
        this._context = context;
        this._next = next;
        this._error = error;
        this._complete = complete;
    ***REMOVED***
    next(value) ***REMOVED***
        if (!this.isStopped && this._next) ***REMOVED***
            const ***REMOVED*** _parentSubscriber ***REMOVED*** = this;
            if (!config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) ***REMOVED***
                this.__tryOrUnsub(this._next, value);
            ***REMOVED***
            else if (this.__tryOrSetError(_parentSubscriber, this._next, value)) ***REMOVED***
                this.unsubscribe();
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***
    error(err) ***REMOVED***
        if (!this.isStopped) ***REMOVED***
            const ***REMOVED*** _parentSubscriber ***REMOVED*** = this;
            const ***REMOVED*** useDeprecatedSynchronousErrorHandling ***REMOVED*** = config;
            if (this._error) ***REMOVED***
                if (!useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) ***REMOVED***
                    this.__tryOrUnsub(this._error, err);
                    this.unsubscribe();
                ***REMOVED***
                else ***REMOVED***
                    this.__tryOrSetError(_parentSubscriber, this._error, err);
                    this.unsubscribe();
                ***REMOVED***
            ***REMOVED***
            else if (!_parentSubscriber.syncErrorThrowable) ***REMOVED***
                this.unsubscribe();
                if (useDeprecatedSynchronousErrorHandling) ***REMOVED***
                    throw err;
                ***REMOVED***
                hostReportError(err);
            ***REMOVED***
            else ***REMOVED***
                if (useDeprecatedSynchronousErrorHandling) ***REMOVED***
                    _parentSubscriber.syncErrorValue = err;
                    _parentSubscriber.syncErrorThrown = true;
                ***REMOVED***
                else ***REMOVED***
                    hostReportError(err);
                ***REMOVED***
                this.unsubscribe();
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***
    complete() ***REMOVED***
        if (!this.isStopped) ***REMOVED***
            const ***REMOVED*** _parentSubscriber ***REMOVED*** = this;
            if (this._complete) ***REMOVED***
                const wrappedComplete = () => this._complete.call(this._context);
                if (!config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) ***REMOVED***
                    this.__tryOrUnsub(wrappedComplete);
                    this.unsubscribe();
                ***REMOVED***
                else ***REMOVED***
                    this.__tryOrSetError(_parentSubscriber, wrappedComplete);
                    this.unsubscribe();
                ***REMOVED***
            ***REMOVED***
            else ***REMOVED***
                this.unsubscribe();
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***
    __tryOrUnsub(fn, value) ***REMOVED***
        try ***REMOVED***
            fn.call(this._context, value);
        ***REMOVED***
        catch (err) ***REMOVED***
            this.unsubscribe();
            if (config.useDeprecatedSynchronousErrorHandling) ***REMOVED***
                throw err;
            ***REMOVED***
            else ***REMOVED***
                hostReportError(err);
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***
    __tryOrSetError(parent, fn, value) ***REMOVED***
        if (!config.useDeprecatedSynchronousErrorHandling) ***REMOVED***
            throw new Error('bad call');
        ***REMOVED***
        try ***REMOVED***
            fn.call(this._context, value);
        ***REMOVED***
        catch (err) ***REMOVED***
            if (config.useDeprecatedSynchronousErrorHandling) ***REMOVED***
                parent.syncErrorValue = err;
                parent.syncErrorThrown = true;
                return true;
            ***REMOVED***
            else ***REMOVED***
                hostReportError(err);
                return true;
            ***REMOVED***
        ***REMOVED***
        return false;
    ***REMOVED***
    _unsubscribe() ***REMOVED***
        const ***REMOVED*** _parentSubscriber ***REMOVED*** = this;
        this._context = null;
        this._parentSubscriber = null;
        _parentSubscriber.unsubscribe();
    ***REMOVED***
***REMOVED***
//# sourceMappingURL=Subscriber.js.map