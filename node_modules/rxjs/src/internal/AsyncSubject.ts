import ***REMOVED*** Subject ***REMOVED*** from './Subject';
import ***REMOVED*** Subscriber ***REMOVED*** from './Subscriber';
import ***REMOVED*** Subscription ***REMOVED*** from './Subscription';

/**
 * A variant of Subject that only emits a value when it completes. It will emit
 * its latest value to all its observers on completion.
 *
 * @class AsyncSubject<T>
 */
export class AsyncSubject<T> extends Subject<T> ***REMOVED***
  private value: T = null;
  private hasNext: boolean = false;
  private hasCompleted: boolean = false;

  /** @deprecated This is an internal implementation detail, do not use. */
  _subscribe(subscriber: Subscriber<any>): Subscription ***REMOVED***
    if (this.hasError) ***REMOVED***
      subscriber.error(this.thrownError);
      return Subscription.EMPTY;
    ***REMOVED*** else if (this.hasCompleted && this.hasNext) ***REMOVED***
      subscriber.next(this.value);
      subscriber.complete();
      return Subscription.EMPTY;
    ***REMOVED***
    return super._subscribe(subscriber);
  ***REMOVED***

  next(value: T): void ***REMOVED***
    if (!this.hasCompleted) ***REMOVED***
      this.value = value;
      this.hasNext = true;
    ***REMOVED***
  ***REMOVED***

  error(error: any): void ***REMOVED***
    if (!this.hasCompleted) ***REMOVED***
      super.error(error);
    ***REMOVED***
  ***REMOVED***

  complete(): void ***REMOVED***
    this.hasCompleted = true;
    if (this.hasNext) ***REMOVED***
      super.next(this.value);
    ***REMOVED***
    super.complete();
  ***REMOVED***
***REMOVED***
