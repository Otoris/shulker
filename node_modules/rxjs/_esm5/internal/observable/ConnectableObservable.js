/** PURE_IMPORTS_START tslib,_Subject,_Observable,_Subscriber,_Subscription,_operators_refCount PURE_IMPORTS_END */
import * as tslib_1 from "tslib";
import ***REMOVED*** SubjectSubscriber ***REMOVED*** from '../Subject';
import ***REMOVED*** Observable ***REMOVED*** from '../Observable';
import ***REMOVED*** Subscriber ***REMOVED*** from '../Subscriber';
import ***REMOVED*** Subscription ***REMOVED*** from '../Subscription';
import ***REMOVED*** refCount as higherOrderRefCount ***REMOVED*** from '../operators/refCount';
var ConnectableObservable = /*@__PURE__*/ (function (_super) ***REMOVED***
    tslib_1.__extends(ConnectableObservable, _super);
    function ConnectableObservable(source, subjectFactory) ***REMOVED***
        var _this = _super.call(this) || this;
        _this.source = source;
        _this.subjectFactory = subjectFactory;
        _this._refCount = 0;
        _this._isComplete = false;
        return _this;
    ***REMOVED***
    ConnectableObservable.prototype._subscribe = function (subscriber) ***REMOVED***
        return this.getSubject().subscribe(subscriber);
    ***REMOVED***;
    ConnectableObservable.prototype.getSubject = function () ***REMOVED***
        var subject = this._subject;
        if (!subject || subject.isStopped) ***REMOVED***
            this._subject = this.subjectFactory();
        ***REMOVED***
        return this._subject;
    ***REMOVED***;
    ConnectableObservable.prototype.connect = function () ***REMOVED***
        var connection = this._connection;
        if (!connection) ***REMOVED***
            this._isComplete = false;
            connection = this._connection = new Subscription();
            connection.add(this.source
                .subscribe(new ConnectableSubscriber(this.getSubject(), this)));
            if (connection.closed) ***REMOVED***
                this._connection = null;
                connection = Subscription.EMPTY;
            ***REMOVED***
        ***REMOVED***
        return connection;
    ***REMOVED***;
    ConnectableObservable.prototype.refCount = function () ***REMOVED***
        return higherOrderRefCount()(this);
    ***REMOVED***;
    return ConnectableObservable;
***REMOVED***(Observable));
export ***REMOVED*** ConnectableObservable ***REMOVED***;
export var connectableObservableDescriptor = /*@__PURE__*/ (function () ***REMOVED***
    var connectableProto = ConnectableObservable.prototype;
    return ***REMOVED***
        operator: ***REMOVED*** value: null ***REMOVED***,
        _refCount: ***REMOVED*** value: 0, writable: true ***REMOVED***,
        _subject: ***REMOVED*** value: null, writable: true ***REMOVED***,
        _connection: ***REMOVED*** value: null, writable: true ***REMOVED***,
        _subscribe: ***REMOVED*** value: connectableProto._subscribe ***REMOVED***,
        _isComplete: ***REMOVED*** value: connectableProto._isComplete, writable: true ***REMOVED***,
        getSubject: ***REMOVED*** value: connectableProto.getSubject ***REMOVED***,
        connect: ***REMOVED*** value: connectableProto.connect ***REMOVED***,
        refCount: ***REMOVED*** value: connectableProto.refCount ***REMOVED***
    ***REMOVED***;
***REMOVED***)();
var ConnectableSubscriber = /*@__PURE__*/ (function (_super) ***REMOVED***
    tslib_1.__extends(ConnectableSubscriber, _super);
    function ConnectableSubscriber(destination, connectable) ***REMOVED***
        var _this = _super.call(this, destination) || this;
        _this.connectable = connectable;
        return _this;
    ***REMOVED***
    ConnectableSubscriber.prototype._error = function (err) ***REMOVED***
        this._unsubscribe();
        _super.prototype._error.call(this, err);
    ***REMOVED***;
    ConnectableSubscriber.prototype._complete = function () ***REMOVED***
        this.connectable._isComplete = true;
        this._unsubscribe();
        _super.prototype._complete.call(this);
    ***REMOVED***;
    ConnectableSubscriber.prototype._unsubscribe = function () ***REMOVED***
        var connectable = this.connectable;
        if (connectable) ***REMOVED***
            this.connectable = null;
            var connection = connectable._connection;
            connectable._refCount = 0;
            connectable._subject = null;
            connectable._connection = null;
            if (connection) ***REMOVED***
                connection.unsubscribe();
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***;
    return ConnectableSubscriber;
***REMOVED***(SubjectSubscriber));
var RefCountOperator = /*@__PURE__*/ (function () ***REMOVED***
    function RefCountOperator(connectable) ***REMOVED***
        this.connectable = connectable;
    ***REMOVED***
    RefCountOperator.prototype.call = function (subscriber, source) ***REMOVED***
        var connectable = this.connectable;
        connectable._refCount++;
        var refCounter = new RefCountSubscriber(subscriber, connectable);
        var subscription = source.subscribe(refCounter);
        if (!refCounter.closed) ***REMOVED***
            refCounter.connection = connectable.connect();
        ***REMOVED***
        return subscription;
    ***REMOVED***;
    return RefCountOperator;
***REMOVED***());
var RefCountSubscriber = /*@__PURE__*/ (function (_super) ***REMOVED***
    tslib_1.__extends(RefCountSubscriber, _super);
    function RefCountSubscriber(destination, connectable) ***REMOVED***
        var _this = _super.call(this, destination) || this;
        _this.connectable = connectable;
        return _this;
    ***REMOVED***
    RefCountSubscriber.prototype._unsubscribe = function () ***REMOVED***
        var connectable = this.connectable;
        if (!connectable) ***REMOVED***
            this.connection = null;
            return;
        ***REMOVED***
        this.connectable = null;
        var refCount = connectable._refCount;
        if (refCount <= 0) ***REMOVED***
            this.connection = null;
            return;
        ***REMOVED***
        connectable._refCount = refCount - 1;
        if (refCount > 1) ***REMOVED***
            this.connection = null;
            return;
        ***REMOVED***
        var connection = this.connection;
        var sharedConnection = connectable._connection;
        this.connection = null;
        if (sharedConnection && (!connection || sharedConnection === connection)) ***REMOVED***
            sharedConnection.unsubscribe();
        ***REMOVED***
    ***REMOVED***;
    return RefCountSubscriber;
***REMOVED***(Subscriber));
//# sourceMappingURL=ConnectableObservable.js.map
