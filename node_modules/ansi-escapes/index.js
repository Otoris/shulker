'use strict';
const x = module.exports;
const ESC = '\u001B[';
const OSC = '\u001B]';
const BEL = '\u0007';
const SEP = ';';
const isTerminalApp = process.env.TERM_PROGRAM === 'Apple_Terminal';

x.cursorTo = (x, y) => ***REMOVED***
	if (typeof x !== 'number') ***REMOVED***
		throw new TypeError('The `x` argument is required');
	***REMOVED***

	if (typeof y !== 'number') ***REMOVED***
		return ESC + (x + 1) + 'G';
	***REMOVED***

	return ESC + (y + 1) + ';' + (x + 1) + 'H';
***REMOVED***;

x.cursorMove = (x, y) => ***REMOVED***
	if (typeof x !== 'number') ***REMOVED***
		throw new TypeError('The `x` argument is required');
	***REMOVED***

	let ret = '';

	if (x < 0) ***REMOVED***
		ret += ESC + (-x) + 'D';
	***REMOVED*** else if (x > 0) ***REMOVED***
		ret += ESC + x + 'C';
	***REMOVED***

	if (y < 0) ***REMOVED***
		ret += ESC + (-y) + 'A';
	***REMOVED*** else if (y > 0) ***REMOVED***
		ret += ESC + y + 'B';
	***REMOVED***

	return ret;
***REMOVED***;

x.cursorUp = count => ESC + (typeof count === 'number' ? count : 1) + 'A';
x.cursorDown = count => ESC + (typeof count === 'number' ? count : 1) + 'B';
x.cursorForward = count => ESC + (typeof count === 'number' ? count : 1) + 'C';
x.cursorBackward = count => ESC + (typeof count === 'number' ? count : 1) + 'D';

x.cursorLeft = ESC + 'G';
x.cursorSavePosition = ESC + (isTerminalApp ? '7' : 's');
x.cursorRestorePosition = ESC + (isTerminalApp ? '8' : 'u');
x.cursorGetPosition = ESC + '6n';
x.cursorNextLine = ESC + 'E';
x.cursorPrevLine = ESC + 'F';
x.cursorHide = ESC + '?25l';
x.cursorShow = ESC + '?25h';

x.eraseLines = count => ***REMOVED***
	let clear = '';

	for (let i = 0; i < count; i++) ***REMOVED***
		clear += x.eraseLine + (i < count - 1 ? x.cursorUp() : '');
	***REMOVED***

	if (count) ***REMOVED***
		clear += x.cursorLeft;
	***REMOVED***

	return clear;
***REMOVED***;

x.eraseEndLine = ESC + 'K';
x.eraseStartLine = ESC + '1K';
x.eraseLine = ESC + '2K';
x.eraseDown = ESC + 'J';
x.eraseUp = ESC + '1J';
x.eraseScreen = ESC + '2J';
x.scrollUp = ESC + 'S';
x.scrollDown = ESC + 'T';

x.clearScreen = '\u001Bc';

x.clearTerminal = process.platform === 'win32' ?
	`$***REMOVED***x.eraseScreen***REMOVED***$***REMOVED***ESC***REMOVED***0f` :
	// 1. Erases the screen (Only done in case `2` is not supported)
	// 2. Erases the whole screen including scrollback buffer
	// 3. Moves cursor to the top-left position
	// More info: https://www.real-world-systems.com/docs/ANSIcode.html
	`$***REMOVED***x.eraseScreen***REMOVED***$***REMOVED***ESC***REMOVED***3J$***REMOVED***ESC***REMOVED***H`;

x.beep = BEL;

x.link = (text, url) => ***REMOVED***
	return [
		OSC,
		'8',
		SEP,
		SEP,
		url,
		BEL,
		text,
		OSC,
		'8',
		SEP,
		SEP,
		BEL
	].join('');
***REMOVED***;

x.image = (buf, opts) => ***REMOVED***
	opts = opts || ***REMOVED******REMOVED***;

	let ret = OSC + '1337;File=inline=1';

	if (opts.width) ***REMOVED***
		ret += `;width=$***REMOVED***opts.width***REMOVED***`;
	***REMOVED***

	if (opts.height) ***REMOVED***
		ret += `;height=$***REMOVED***opts.height***REMOVED***`;
	***REMOVED***

	if (opts.preserveAspectRatio === false) ***REMOVED***
		ret += ';preserveAspectRatio=0';
	***REMOVED***

	return ret + ':' + buf.toString('base64') + BEL;
***REMOVED***;

x.iTerm = ***REMOVED******REMOVED***;

x.iTerm.setCwd = cwd => OSC + '50;CurrentDir=' + (cwd || process.cwd()) + BEL;
