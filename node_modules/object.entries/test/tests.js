'use strict';

var keys = require('object-keys');
var map = require('array-map');
var define = require('define-properties');

var hasSymbols = typeof Symbol === 'function' && typeof Symbol('foo') === 'symbol';

module.exports = function (entries, t) ***REMOVED***
	var a = ***REMOVED******REMOVED***;
	var b = ***REMOVED******REMOVED***;
	var c = ***REMOVED******REMOVED***;
	var obj = ***REMOVED*** a: a, b: b, c: c ***REMOVED***;

	t.deepEqual(entries(obj), [['a', a], ['b', b], ['c', c]], 'basic support');
	t.deepEqual(entries(***REMOVED*** a: a, b: a, c: c ***REMOVED***), [['a', a], ['b', a], ['c', c]], 'duplicate entries are included');

	t.test('entries are in the same order as keys', function (st) ***REMOVED***
		var object = ***REMOVED*** a: a, b: b ***REMOVED***;
		object[0] = 3;
		object.c = c;
		object[1] = 4;
		delete object[0];
		var objKeys = keys(object);
		var objEntries = map(objKeys, function (key) ***REMOVED***
			return [key, object[key]];
		***REMOVED***);
		st.deepEqual(entries(object), objEntries, 'entries match key order');
		st.end();
	***REMOVED***);

	t.test('non-enumerable properties are omitted', ***REMOVED*** skip: !Object.defineProperty ***REMOVED***, function (st) ***REMOVED***
		var object = ***REMOVED*** a: a, b: b ***REMOVED***;
		Object.defineProperty(object, 'c', ***REMOVED*** enumerable: false, value: c ***REMOVED***);
		st.deepEqual(entries(object), [['a', a], ['b', b]], 'non-enumerable propertyâ€˜s value is omitted');
		st.end();
	***REMOVED***);

	t.test('inherited properties are omitted', function (st) ***REMOVED***
		var F = function G() ***REMOVED******REMOVED***;
		F.prototype.a = a;
		var f = new F();
		f.b = b;
		st.deepEqual(entries(f), [['b', b]], 'only own properties are included');
		st.end();
	***REMOVED***);

	t.test('Symbol properties are omitted', ***REMOVED*** skip: !hasSymbols ***REMOVED***, function (st) ***REMOVED***
		var object = ***REMOVED*** a: a, b: b, c: c ***REMOVED***;
		var enumSym = Symbol('enum');
		var nonEnumSym = Symbol('non enum');
		object[enumSym] = enumSym;
		object.d = enumSym;
		Object.defineProperty(object, nonEnumSym, ***REMOVED*** enumerable: false, value: nonEnumSym ***REMOVED***);
		st.deepEqual(entries(object), [['a', a], ['b', b], ['c', c], ['d', enumSym]], 'symbol properties are omitted');
		st.end();
	***REMOVED***);

	t.test('not-yet-visited keys deleted on [[Get]] must not show up in output', ***REMOVED*** skip: !define.supportsDescriptors ***REMOVED***, function (st) ***REMOVED***
		var o = ***REMOVED*** a: 1, b: 2, c: 3 ***REMOVED***;
		Object.defineProperty(o, 'a', ***REMOVED***
			get: function () ***REMOVED***
				delete this.b;
				return 1;
			***REMOVED***
		***REMOVED***);
		st.deepEqual(entries(o), [['a', 1], ['c', 3]], 'when "b" is deleted prior to being visited, it should not show up');
		st.end();
	***REMOVED***);

	t.test('not-yet-visited keys made non-enumerable on [[Get]] must not show up in output', ***REMOVED*** skip: !define.supportsDescriptors ***REMOVED***, function (st) ***REMOVED***
		var o = ***REMOVED*** a: 'A', b: 'B' ***REMOVED***;
		Object.defineProperty(o, 'a', ***REMOVED***
			get: function () ***REMOVED***
				Object.defineProperty(o, 'b', ***REMOVED*** enumerable: false ***REMOVED***);
				return 'A';
			***REMOVED***
		***REMOVED***);
		st.deepEqual(entries(o), [['a', 'A']], 'when "b" is made non-enumerable prior to being visited, it should not show up');
		st.end();
	***REMOVED***);
***REMOVED***;
