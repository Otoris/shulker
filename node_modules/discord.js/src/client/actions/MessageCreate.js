const Action = require('./Action');
const Message = require('../../structures/Message');

class MessageCreateAction extends Action ***REMOVED***
  handle(data) ***REMOVED***
    const client = this.client;

    const channel = client.channels.get((data instanceof Array ? data[0] : data).channel_id);
    const user = client.users.get((data instanceof Array ? data[0] : data).author.id);
    if (channel) ***REMOVED***
      const member = channel.guild ? channel.guild.member(user) : null;
      if (data instanceof Array) ***REMOVED***
        const messages = new Array(data.length);
        for (let i = 0; i < data.length; i++) ***REMOVED***
          messages[i] = channel._cacheMessage(new Message(channel, data[i], client));
        ***REMOVED***
        const lastMessage = messages[messages.length - 1];
        channel.lastMessageID = lastMessage.id;
        if (user) ***REMOVED***
          user.lastMessageID = lastMessage.id;
          user.lastMessage = lastMessage;
        ***REMOVED***
        if (member) ***REMOVED***
          member.lastMessageID = lastMessage.id;
          member.lastMessage = lastMessage;
        ***REMOVED***
        return ***REMOVED***
          messages,
        ***REMOVED***;
      ***REMOVED*** else ***REMOVED***
        const message = channel._cacheMessage(new Message(channel, data, client));
        channel.lastMessageID = data.id;
        if (user) ***REMOVED***
          user.lastMessageID = data.id;
          user.lastMessage = message;
        ***REMOVED***
        if (member) ***REMOVED***
          member.lastMessageID = data.id;
          member.lastMessage = message;
        ***REMOVED***
        return ***REMOVED***
          message,
        ***REMOVED***;
      ***REMOVED***
    ***REMOVED***

    return ***REMOVED***
      message: null,
    ***REMOVED***;
  ***REMOVED***
***REMOVED***

module.exports = MessageCreateAction;
