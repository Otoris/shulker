const Action = require('./Action');
const DMChannel = require('../../structures/DMChannel');

class ChannelDeleteAction extends Action ***REMOVED***
  constructor(client) ***REMOVED***
    super(client);
    this.deleted = new Map();
  ***REMOVED***

  handle(data) ***REMOVED***
    const client = this.client;

    let channel = client.channels.get(data.id);
    if (channel) ***REMOVED***
      client.dataManager.killChannel(channel);
      this.deleted.set(channel.id, channel);
      this.scheduleForDeletion(channel.id);
    ***REMOVED*** else ***REMOVED***
      channel = this.deleted.get(data.id) || null;
    ***REMOVED***
    if (channel) ***REMOVED***
      if (channel.messages && !(channel instanceof DMChannel)) ***REMOVED***
        for (const message of channel.messages.values()) ***REMOVED***
          message.deleted = true;
        ***REMOVED***
      ***REMOVED***
      channel.deleted = true;
    ***REMOVED***

    return ***REMOVED*** channel ***REMOVED***;
  ***REMOVED***

  scheduleForDeletion(id) ***REMOVED***
    this.client.setTimeout(() => this.deleted.delete(id), this.client.options.restWsBridgeTimeout);
  ***REMOVED***
***REMOVED***

module.exports = ChannelDeleteAction;
