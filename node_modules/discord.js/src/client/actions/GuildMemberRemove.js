const Action = require('./Action');
const Constants = require('../../util/Constants');

class GuildMemberRemoveAction extends Action ***REMOVED***
  constructor(client) ***REMOVED***
    super(client);
    this.deleted = new Map();
  ***REMOVED***

  handle(data) ***REMOVED***
    const client = this.client;
    const guild = client.guilds.get(data.guild_id);
    let member = null;
    if (guild) ***REMOVED***
      member = guild.members.get(data.user.id);
      guild.memberCount--;
      if (member) ***REMOVED***
        guild._removeMember(member);
        this.deleted.set(guild.id + data.user.id, member);
        if (client.status === Constants.Status.READY) client.emit(Constants.Events.GUILD_MEMBER_REMOVE, member);
        this.scheduleForDeletion(guild.id, data.user.id);
      ***REMOVED*** else ***REMOVED***
        member = this.deleted.get(guild.id + data.user.id) || null;
      ***REMOVED***
      if (member) member.deleted = true;
    ***REMOVED***
    return ***REMOVED*** guild, member ***REMOVED***;
  ***REMOVED***

  scheduleForDeletion(guildID, userID) ***REMOVED***
    this.client.setTimeout(() => this.deleted.delete(guildID + userID), this.client.options.restWsBridgeTimeout);
  ***REMOVED***
***REMOVED***

/**
 * Emitted whenever a member leaves a guild, or is kicked.
 * @event Client#guildMemberRemove
 * @param ***REMOVED***GuildMember***REMOVED*** member The member that has left/been kicked from the guild
 */

module.exports = GuildMemberRemoveAction;
