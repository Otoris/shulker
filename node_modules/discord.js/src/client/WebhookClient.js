const Webhook = require('../structures/Webhook');
const RESTManager = require('./rest/RESTManager');
const ClientDataResolver = require('./ClientDataResolver');
const Constants = require('../util/Constants');
const Util = require('../util/Util');

/**
 * The webhook client.
 * @extends ***REMOVED***Webhook***REMOVED***
 */
class WebhookClient extends Webhook ***REMOVED***
  /**
   * @param ***REMOVED***Snowflake***REMOVED*** id ID of the webhook
   * @param ***REMOVED***string***REMOVED*** token Token of the webhook
   * @param ***REMOVED***ClientOptions***REMOVED*** [options] Options for the client
   * @example
   * // Create a new webhook and send a message
   * const hook = new Discord.WebhookClient('1234', 'abcdef');
   * hook.sendMessage('This will send a message').catch(console.error);
   */
  constructor(id, token, options) ***REMOVED***
    super(null, id, token);

    /**
     * The options the client was instantiated with
     * @type ***REMOVED***ClientOptions***REMOVED***
     */
    this.options = Util.mergeDefault(Constants.DefaultOptions, options);

    /**
     * The REST manager of the client
     * @type ***REMOVED***RESTManager***REMOVED***
     * @private
     */
    this.rest = new RESTManager(this);

    /**
     * The data resolver of the client
     * @type ***REMOVED***ClientDataResolver***REMOVED***
     * @private
     */
    this.resolver = new ClientDataResolver(this);

    /**
     * Timeouts set by ***REMOVED***@link WebhookClient#setTimeout***REMOVED*** that are still active
     * @type ***REMOVED***Set<Timeout>***REMOVED***
     * @private
     */
    this._timeouts = new Set();

    /**
     * Intervals set by ***REMOVED***@link WebhookClient#setInterval***REMOVED*** that are still active
     * @type ***REMOVED***Set<Timeout>***REMOVED***
     * @private
     */
    this._intervals = new Set();
  ***REMOVED***

  /**
   * Sets a timeout that will be automatically cancelled if the client is destroyed.
   * @param ***REMOVED***Function***REMOVED*** fn Function to execute
   * @param ***REMOVED***number***REMOVED*** delay Time to wait before executing (in milliseconds)
   * @param ***REMOVED***...****REMOVED*** args Arguments for the function
   * @returns ***REMOVED***Timeout***REMOVED***
   */
  setTimeout(fn, delay, ...args) ***REMOVED***
    const timeout = setTimeout(() => ***REMOVED***
      fn(...args);
      this._timeouts.delete(timeout);
    ***REMOVED***, delay);
    this._timeouts.add(timeout);
    return timeout;
  ***REMOVED***

  /**
   * Clears a timeout.
   * @param ***REMOVED***Timeout***REMOVED*** timeout Timeout to cancel
   */
  clearTimeout(timeout) ***REMOVED***
    clearTimeout(timeout);
    this._timeouts.delete(timeout);
  ***REMOVED***

  /**
   * Sets an interval that will be automatically cancelled if the client is destroyed.
   * @param ***REMOVED***Function***REMOVED*** fn Function to execute
   * @param ***REMOVED***number***REMOVED*** delay Time to wait before executing (in milliseconds)
   * @param ***REMOVED***...****REMOVED*** args Arguments for the function
   * @returns ***REMOVED***Timeout***REMOVED***
   */
  setInterval(fn, delay, ...args) ***REMOVED***
    const interval = setInterval(fn, delay, ...args);
    this._intervals.add(interval);
    return interval;
  ***REMOVED***

  /**
   * Clears an interval.
   * @param ***REMOVED***Timeout***REMOVED*** interval Interval to cancel
   */
  clearInterval(interval) ***REMOVED***
    clearInterval(interval);
    this._intervals.delete(interval);
  ***REMOVED***


  /**
   * Destroys the client.
   */
  destroy() ***REMOVED***
    for (const t of this._timeouts) clearTimeout(t);
    for (const i of this._intervals) clearInterval(i);
    this._timeouts.clear();
    this._intervals.clear();
  ***REMOVED***
***REMOVED***

module.exports = WebhookClient;
