const OpusEngine = require('./BaseOpusEngine');

class OpusScriptEngine extends OpusEngine ***REMOVED***
  constructor(player) ***REMOVED***
    super(player);
    const OpusScript = require('opusscript');
    this.encoder = new OpusScript(this.samplingRate, this.channels);
    super.init();
  ***REMOVED***

  setBitrate(bitrate) ***REMOVED***
    this.encoder.encoderCTL(this.ctl.BITRATE, Math.min(128, Math.max(16, bitrate)) * 1000);
  ***REMOVED***

  setFEC(enabled) ***REMOVED***
    this.encoder.encoderCTL(this.ctl.FEC, enabled ? 1 : 0);
  ***REMOVED***

  setPLP(percent) ***REMOVED***
    this.encoder.encoderCTL(this.ctl.PLP, Math.min(100, Math.max(0, percent * 100)));
  ***REMOVED***

  encode(buffer) ***REMOVED***
    super.encode(buffer);
    return this.encoder.encode(buffer, 960);
  ***REMOVED***

  decode(buffer) ***REMOVED***
    super.decode(buffer);
    return this.encoder.decode(buffer);
  ***REMOVED***

  destroy() ***REMOVED***
    super.destroy();
    this.encoder.delete();
  ***REMOVED***
***REMOVED***

module.exports = OpusScriptEngine;
