var ExternalEditor = require('./main').ExternalEditor;
var readline = require('readline');

var rl = readline.createInterface(***REMOVED***
  input: process.stdin,
  output: null
***REMOVED***);

var message = '\n\n# Please Write a message\n# Any line starting with # is ignored';

process.stdout.write('Please write a message. (press enter to launch your preferred editor)');

editor = new ExternalEditor(message);

rl.on('line', function () ***REMOVED***
  try ***REMOVED***
    // Get response, remove all lines starting with #, remove any trailing newlines.
    var response = editor.run().replace(/^#.*\n?/gm, '').replace(/\n+$/g, '').trim();

    if (editor.lastExitStatus !== 0) ***REMOVED***
      process.stderr.write("WARN: The editor exited with a non-zero status\n\n")
    ***REMOVED***

    if (response.length === 0) ***REMOVED***
      readline.moveCursor(process.stdout, 0, -1);
      process.stdout.write('Your message was empty, please try again. (press enter to launch your preferred editor)');
    ***REMOVED*** else ***REMOVED***
      process.stdout.write('Your Message:\n');
      process.stdout.write(response);
      process.stdout.write('\n');
      rl.close();
    ***REMOVED***
  ***REMOVED*** catch (err) ***REMOVED***
    process.stderr.write(err.message);
    process.stdout.write('\n');
    rl.close();
  ***REMOVED***
***REMOVED***);
