'use strict';
const path = require('path');
const resolveFrom = require('resolve-from');
const parentModule = require('parent-module');

module.exports = moduleId => ***REMOVED***
	if (typeof moduleId !== 'string') ***REMOVED***
		throw new TypeError('Expected a string');
	***REMOVED***

	const parentPath = parentModule(__filename);

	const filePath = resolveFrom(path.dirname(parentPath), moduleId);

	const oldModule = require.cache[filePath];
	// Delete itself from module parent
	if (oldModule && oldModule.parent) ***REMOVED***
		let i = oldModule.parent.children.length;

		while (i--) ***REMOVED***
			if (oldModule.parent.children[i].id === filePath) ***REMOVED***
				oldModule.parent.children.splice(i, 1);
			***REMOVED***
		***REMOVED***
	***REMOVED***

	delete require.cache[filePath]; // Delete module from cache

	const parent = require.cache[parentPath]; // If `filePath` and `parentPath` are the same, cache will already be deleted so we won't get a memory leak in next step

	return parent === undefined ? require(filePath) : parent.require(filePath); // In case cache doesn't have parent, fall back to normal require
***REMOVED***;
