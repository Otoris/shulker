var addSorting = (function () ***REMOVED***
    "use strict";
    var cols,
        currentSort = ***REMOVED***
            index: 0,
            desc: false
        ***REMOVED***;

    // returns the summary table element
    function getTable() ***REMOVED*** return document.querySelector('.coverage-summary'); ***REMOVED***
    // returns the thead element of the summary table
    function getTableHeader() ***REMOVED*** return getTable().querySelector('thead tr'); ***REMOVED***
    // returns the tbody element of the summary table
    function getTableBody() ***REMOVED*** return getTable().querySelector('tbody'); ***REMOVED***
    // returns the th element for nth column
    function getNthColumn(n) ***REMOVED*** return getTableHeader().querySelectorAll('th')[n]; ***REMOVED***

    // loads all columns
    function loadColumns() ***REMOVED***
        var colNodes = getTableHeader().querySelectorAll('th'),
            colNode,
            cols = [],
            col,
            i;

        for (i = 0; i < colNodes.length; i += 1) ***REMOVED***
            colNode = colNodes[i];
            col = ***REMOVED***
                key: colNode.getAttribute('data-col'),
                sortable: !colNode.getAttribute('data-nosort'),
                type: colNode.getAttribute('data-type') || 'string'
            ***REMOVED***;
            cols.push(col);
            if (col.sortable) ***REMOVED***
                col.defaultDescSort = col.type === 'number';
                colNode.innerHTML = colNode.innerHTML + '<span class="sorter"></span>';
            ***REMOVED***
        ***REMOVED***
        return cols;
    ***REMOVED***
    // attaches a data attribute to every tr element with an object
    // of data values keyed by column name
    function loadRowData(tableRow) ***REMOVED***
        var tableCols = tableRow.querySelectorAll('td'),
            colNode,
            col,
            data = ***REMOVED******REMOVED***,
            i,
            val;
        for (i = 0; i < tableCols.length; i += 1) ***REMOVED***
            colNode = tableCols[i];
            col = cols[i];
            val = colNode.getAttribute('data-value');
            if (col.type === 'number') ***REMOVED***
                val = Number(val);
            ***REMOVED***
            data[col.key] = val;
        ***REMOVED***
        return data;
    ***REMOVED***
    // loads all row data
    function loadData() ***REMOVED***
        var rows = getTableBody().querySelectorAll('tr'),
            i;

        for (i = 0; i < rows.length; i += 1) ***REMOVED***
            rows[i].data = loadRowData(rows[i]);
        ***REMOVED***
    ***REMOVED***
    // sorts the table using the data for the ith column
    function sortByIndex(index, desc) ***REMOVED***
        var key = cols[index].key,
            sorter = function (a, b) ***REMOVED***
                a = a.data[key];
                b = b.data[key];
                return a < b ? -1 : a > b ? 1 : 0;
            ***REMOVED***,
            finalSorter = sorter,
            tableBody = document.querySelector('.coverage-summary tbody'),
            rowNodes = tableBody.querySelectorAll('tr'),
            rows = [],
            i;

        if (desc) ***REMOVED***
            finalSorter = function (a, b) ***REMOVED***
                return -1 * sorter(a, b);
            ***REMOVED***;
        ***REMOVED***

        for (i = 0; i < rowNodes.length; i += 1) ***REMOVED***
            rows.push(rowNodes[i]);
            tableBody.removeChild(rowNodes[i]);
        ***REMOVED***

        rows.sort(finalSorter);

        for (i = 0; i < rows.length; i += 1) ***REMOVED***
            tableBody.appendChild(rows[i]);
        ***REMOVED***
    ***REMOVED***
    // removes sort indicators for current column being sorted
    function removeSortIndicators() ***REMOVED***
        var col = getNthColumn(currentSort.index),
            cls = col.className;

        cls = cls.replace(/ sorted$/, '').replace(/ sorted-desc$/, '');
        col.className = cls;
    ***REMOVED***
    // adds sort indicators for current column being sorted
    function addSortIndicators() ***REMOVED***
        getNthColumn(currentSort.index).className += currentSort.desc ? ' sorted-desc' : ' sorted';
    ***REMOVED***
    // adds event listeners for all sorter widgets
    function enableUI() ***REMOVED***
        var i,
            el,
            ithSorter = function ithSorter(i) ***REMOVED***
                var col = cols[i];

                return function () ***REMOVED***
                    var desc = col.defaultDescSort;

                    if (currentSort.index === i) ***REMOVED***
                        desc = !currentSort.desc;
                    ***REMOVED***
                    sortByIndex(i, desc);
                    removeSortIndicators();
                    currentSort.index = i;
                    currentSort.desc = desc;
                    addSortIndicators();
                ***REMOVED***;
            ***REMOVED***;
        for (i =0 ; i < cols.length; i += 1) ***REMOVED***
            if (cols[i].sortable) ***REMOVED***
                // add the click event handler on the th so users
                // dont have to click on those tiny arrows
                el = getNthColumn(i).querySelector('.sorter').parentElement;
                if (el.addEventListener) ***REMOVED***
                    el.addEventListener('click', ithSorter(i));
                ***REMOVED*** else ***REMOVED***
                    el.attachEvent('onclick', ithSorter(i));
                ***REMOVED***
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***
    // adds sorting functionality to the UI
    return function () ***REMOVED***
        if (!getTable()) ***REMOVED***
            return;
        ***REMOVED***
        cols = loadColumns();
        loadData(cols);
        addSortIndicators();
        enableUI();
    ***REMOVED***;
***REMOVED***)();

window.addEventListener('load', addSorting);
