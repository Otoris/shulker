var path = require('path');
var test = require('tape');
var resolve = require('../');

var resolverDir = path.join(__dirname, '/pathfilter/deep_ref');

var pathFilterFactory = function (t) ***REMOVED***
    return function (pkg, x, remainder) ***REMOVED***
        t.equal(pkg.version, '1.2.3');
        t.equal(x, path.join(resolverDir, 'node_modules/deep/ref'));
        t.equal(remainder, 'ref');
        return 'alt';
    ***REMOVED***;
***REMOVED***;

test('#62: deep module references and the pathFilter', function (t) ***REMOVED***
    t.test('deep/ref.js', function (st) ***REMOVED***
        st.plan(3);

        resolve('deep/ref', ***REMOVED*** basedir: resolverDir ***REMOVED***, function (err, res, pkg) ***REMOVED***
            if (err) st.fail(err);

            st.equal(pkg.version, '1.2.3');
            st.equal(res, path.join(resolverDir, 'node_modules/deep/ref.js'));
        ***REMOVED***);

        var res = resolve.sync('deep/ref', ***REMOVED*** basedir: resolverDir ***REMOVED***);
        st.equal(res, path.join(resolverDir, 'node_modules/deep/ref.js'));
    ***REMOVED***);

    t.test('deep/deeper/ref', function (st) ***REMOVED***
        st.plan(4);

        resolve(
            'deep/deeper/ref',
            ***REMOVED*** basedir: resolverDir ***REMOVED***,
            function (err, res, pkg) ***REMOVED***
                if (err) t.fail(err);
                st.notEqual(pkg, undefined);
                st.equal(pkg.version, '1.2.3');
                st.equal(res, path.join(resolverDir, 'node_modules/deep/deeper/ref.js'));
            ***REMOVED***
        );

        var res = resolve.sync(
            'deep/deeper/ref',
            ***REMOVED*** basedir: resolverDir ***REMOVED***
        );
        st.equal(res, path.join(resolverDir, 'node_modules/deep/deeper/ref.js'));
    ***REMOVED***);

    t.test('deep/ref alt', function (st) ***REMOVED***
        st.plan(8);

        var pathFilter = pathFilterFactory(st);

        var res = resolve.sync(
            'deep/ref',
            ***REMOVED*** basedir: resolverDir, pathFilter: pathFilter ***REMOVED***
        );
        st.equal(res, path.join(resolverDir, 'node_modules/deep/alt.js'));

        resolve(
            'deep/ref',
            ***REMOVED*** basedir: resolverDir, pathFilter: pathFilter ***REMOVED***,
            function (err, res, pkg) ***REMOVED***
                if (err) st.fail(err);
                st.equal(res, path.join(resolverDir, 'node_modules/deep/alt.js'));
                st.end();
            ***REMOVED***
        );
    ***REMOVED***);

    t.end();
***REMOVED***);
