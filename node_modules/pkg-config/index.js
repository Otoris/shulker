'use strict'

var debug = require('debug-log')('pkg-config')
var extend = require('xtend')
var find = require('find-root')
var fs = require('fs')
var path = require('path')

module.exports = function (namespace, options, fallback) ***REMOVED***
  var opts = extend(***REMOVED***
    root: 'config',
    cwd: process.cwd(),
    cache: true
  ***REMOVED***, options || ***REMOVED******REMOVED***)

  try ***REMOVED***
    var root = find(opts.cwd)

    if (!root) ***REMOVED***
      debug('could not find at %s', opts.cwd)

      return
    ***REMOVED***

    debug('found root at %s', root)

    var pkg

    if (opts.cache) ***REMOVED***
      pkg = require(path.join(root, 'package.json'))
    ***REMOVED*** else ***REMOVED***
      pkg = fs.readFileSync(path.join(root, 'package.json'), ***REMOVED***enconding: 'utf8'***REMOVED***)
      pkg = JSON.parse(pkg)
    ***REMOVED***

    debug('found package.json at %s', root)

    // where should we look under?
    var parent = opts.root ? pkg[opts.root] : pkg

    // do we have a custom namespace?
    var config = namespace ? parent[namespace] : parent

    // return found result or default
    return config || fallback
  ***REMOVED*** catch (e) ***REMOVED***
    debug(e.message)
  ***REMOVED***
***REMOVED***
