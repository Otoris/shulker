/**
 * @fileoverview Config file operations. This file must be usable in the browser,
 * so no Node-specific code can be here.
 * @author Nicholas C. Zakas
 */
"use strict";

//------------------------------------------------------------------------------
// Private
//------------------------------------------------------------------------------

const RULE_SEVERITY_STRINGS = ["off", "warn", "error"],
    RULE_SEVERITY = RULE_SEVERITY_STRINGS.reduce((map, value, index) => ***REMOVED***
        map[value] = index;
        return map;
    ***REMOVED***, ***REMOVED******REMOVED***),
    VALID_SEVERITIES = [0, 1, 2, "off", "warn", "error"];

//------------------------------------------------------------------------------
// Public Interface
//------------------------------------------------------------------------------

module.exports = ***REMOVED***

    /**
     * Normalizes the severity value of a rule's configuration to a number
     * @param ***REMOVED***(number|string|[number, ...*]|[string, ...*])***REMOVED*** ruleConfig A rule's configuration value, generally
     * received from the user. A valid config value is either 0, 1, 2, the string "off" (treated the same as 0),
     * the string "warn" (treated the same as 1), the string "error" (treated the same as 2), or an array
     * whose first element is one of the above values. Strings are matched case-insensitively.
     * @returns ***REMOVED***(0|1|2)***REMOVED*** The numeric severity value if the config value was valid, otherwise 0.
     */
    getRuleSeverity(ruleConfig) ***REMOVED***
        const severityValue = Array.isArray(ruleConfig) ? ruleConfig[0] : ruleConfig;

        if (severityValue === 0 || severityValue === 1 || severityValue === 2) ***REMOVED***
            return severityValue;
        ***REMOVED***

        if (typeof severityValue === "string") ***REMOVED***
            return RULE_SEVERITY[severityValue.toLowerCase()] || 0;
        ***REMOVED***

        return 0;
    ***REMOVED***,

    /**
     * Converts old-style severity settings (0, 1, 2) into new-style
     * severity settings (off, warn, error) for all rules. Assumption is that severity
     * values have already been validated as correct.
     * @param ***REMOVED***Object***REMOVED*** config The config object to normalize.
     * @returns ***REMOVED***void***REMOVED***
     */
    normalizeToStrings(config) ***REMOVED***

        if (config.rules) ***REMOVED***
            Object.keys(config.rules).forEach(ruleId => ***REMOVED***
                const ruleConfig = config.rules[ruleId];

                if (typeof ruleConfig === "number") ***REMOVED***
                    config.rules[ruleId] = RULE_SEVERITY_STRINGS[ruleConfig] || RULE_SEVERITY_STRINGS[0];
                ***REMOVED*** else if (Array.isArray(ruleConfig) && typeof ruleConfig[0] === "number") ***REMOVED***
                    ruleConfig[0] = RULE_SEVERITY_STRINGS[ruleConfig[0]] || RULE_SEVERITY_STRINGS[0];
                ***REMOVED***
            ***REMOVED***);
        ***REMOVED***
    ***REMOVED***,

    /**
     * Determines if the severity for the given rule configuration represents an error.
     * @param ***REMOVED***int|string|Array***REMOVED*** ruleConfig The configuration for an individual rule.
     * @returns ***REMOVED***boolean***REMOVED*** True if the rule represents an error, false if not.
     */
    isErrorSeverity(ruleConfig) ***REMOVED***
        return module.exports.getRuleSeverity(ruleConfig) === 2;
    ***REMOVED***,

    /**
     * Checks whether a given config has valid severity or not.
     * @param ***REMOVED***number|string|Array***REMOVED*** ruleConfig - The configuration for an individual rule.
     * @returns ***REMOVED***boolean***REMOVED*** `true` if the configuration has valid severity.
     */
    isValidSeverity(ruleConfig) ***REMOVED***
        let severity = Array.isArray(ruleConfig) ? ruleConfig[0] : ruleConfig;

        if (typeof severity === "string") ***REMOVED***
            severity = severity.toLowerCase();
        ***REMOVED***
        return VALID_SEVERITIES.indexOf(severity) !== -1;
    ***REMOVED***,

    /**
     * Checks whether every rule of a given config has valid severity or not.
     * @param ***REMOVED***Object***REMOVED*** config - The configuration for rules.
     * @returns ***REMOVED***boolean***REMOVED*** `true` if the configuration has valid severity.
     */
    isEverySeverityValid(config) ***REMOVED***
        return Object.keys(config).every(ruleId => this.isValidSeverity(config[ruleId]));
    ***REMOVED***,

    /**
     * Normalizes a value for a global in a config
     * @param ***REMOVED***(boolean|string|null)***REMOVED*** configuredValue The value given for a global in configuration or in
     * a global directive comment
     * @returns ***REMOVED***("readable"|"writeable"|"off")***REMOVED*** The value normalized as a string
     * @throws Error if global value is invalid
     */
    normalizeConfigGlobal(configuredValue) ***REMOVED***
        switch (configuredValue) ***REMOVED***
            case "off":
                return "off";

            case true:
            case "true":
            case "writeable":
            case "writable":
                return "writable";

            case null:
            case false:
            case "false":
            case "readable":
            case "readonly":
                return "readonly";

            default:
                throw new Error(`'$***REMOVED***configuredValue***REMOVED***' is not a valid configuration for a global (use 'readonly', 'writable', or 'off')`);
        ***REMOVED***
    ***REMOVED***
***REMOVED***;
