/**
 * @fileoverview Stylish reporter
 * @author Sindre Sorhus
 */
"use strict";

const chalk = require("chalk"),
    stripAnsi = require("strip-ansi"),
    table = require("text-table");

//------------------------------------------------------------------------------
// Helpers
//------------------------------------------------------------------------------

/**
 * Given a word and a count, append an s if count is not one.
 * @param ***REMOVED***string***REMOVED*** word A word in its singular form.
 * @param ***REMOVED***int***REMOVED*** count A number controlling whether word should be pluralized.
 * @returns ***REMOVED***string***REMOVED*** The original word with an s on the end if count is not one.
 */
function pluralize(word, count) ***REMOVED***
    return (count === 1 ? word : `$***REMOVED***word***REMOVED***s`);
***REMOVED***

//------------------------------------------------------------------------------
// Public Interface
//------------------------------------------------------------------------------

module.exports = function(results) ***REMOVED***

    let output = "\n",
        errorCount = 0,
        warningCount = 0,
        fixableErrorCount = 0,
        fixableWarningCount = 0,
        summaryColor = "yellow";

    results.forEach(result => ***REMOVED***
        const messages = result.messages;

        if (messages.length === 0) ***REMOVED***
            return;
        ***REMOVED***

        errorCount += result.errorCount;
        warningCount += result.warningCount;
        fixableErrorCount += result.fixableErrorCount;
        fixableWarningCount += result.fixableWarningCount;

        output += `$***REMOVED***chalk.underline(result.filePath)***REMOVED***\n`;

        output += `$***REMOVED***table(
            messages.map(message => ***REMOVED***
                let messageType;

                if (message.fatal || message.severity === 2) ***REMOVED***
                    messageType = chalk.red("error");
                    summaryColor = "red";
                ***REMOVED*** else ***REMOVED***
                    messageType = chalk.yellow("warning");
                ***REMOVED***

                return [
                    "",
                    message.line || 0,
                    message.column || 0,
                    messageType,
                    message.message.replace(/([^ ])\.$/u, "$1"),
                    chalk.dim(message.ruleId || "")
                ];
            ***REMOVED***),
            ***REMOVED***
                align: ["", "r", "l"],
                stringLength(str) ***REMOVED***
                    return stripAnsi(str).length;
                ***REMOVED***
            ***REMOVED***
        ).split("\n").map(el => el.replace(/(\d+)\s+(\d+)/u, (m, p1, p2) => chalk.dim(`$***REMOVED***p1***REMOVED***:$***REMOVED***p2***REMOVED***`))).join("\n")***REMOVED***\n\n`;
    ***REMOVED***);

    const total = errorCount + warningCount;

    if (total > 0) ***REMOVED***
        output += chalk[summaryColor].bold([
            "\u2716 ", total, pluralize(" problem", total),
            " (", errorCount, pluralize(" error", errorCount), ", ",
            warningCount, pluralize(" warning", warningCount), ")\n"
        ].join(""));

        if (fixableErrorCount > 0 || fixableWarningCount > 0) ***REMOVED***
            output += chalk[summaryColor].bold([
                "  ", fixableErrorCount, pluralize(" error", fixableErrorCount), " and ",
                fixableWarningCount, pluralize(" warning", fixableWarningCount),
                " potentially fixable with the `--fix` option.\n"
            ].join(""));
        ***REMOVED***
    ***REMOVED***

    // Resets output color, for prevent change on top level
    return total > 0 ? chalk.reset(output) : "";
***REMOVED***;
