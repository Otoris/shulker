'use strict';

var isGlob = require('is-glob');
var pathPosixDirname = require('path').posix.dirname;
var isWin32 = require('os').platform() === 'win32';

var slash = '/';
var backslash = /\\/g;
var enclosure = /[\***REMOVED***\[].*[\/]*.*[\***REMOVED***\]]$/;
var globby = /(^|[^\\])([\***REMOVED***\[]|\([^\)]+$)/;
var escaped = /\\([\*\?\|\[\]\(\)\***REMOVED***\***REMOVED***])/g;

/**
 * @param ***REMOVED***string***REMOVED*** str
 * @param ***REMOVED***Object***REMOVED*** opts
 * @param ***REMOVED***boolean***REMOVED*** [opts.flipBackslashes=true]
 */
module.exports = function globParent(str, opts) ***REMOVED***
  var options = Object.assign(***REMOVED*** flipBackslashes: true ***REMOVED***, opts);

  // flip windows path separators
  if (options.flipBackslashes && isWin32 && str.indexOf(slash) < 0) ***REMOVED***
    str = str.replace(backslash, slash);
  ***REMOVED***

  // special case for strings ending in enclosure containing path separator
  if (enclosure.test(str)) ***REMOVED***
    str += slash;
  ***REMOVED***

  // preserves full path in case of trailing path separator
  str += 'a';

  // remove path parts that are globby
  do ***REMOVED***
    str = pathPosixDirname(str);
  ***REMOVED*** while (isGlob(str) || globby.test(str));

  // remove escape chars and return result
  return str.replace(escaped, '$1');
***REMOVED***;
