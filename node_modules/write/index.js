/*!
 * write <https://github.com/jonschlinkert/write>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */

'use strict';

var fs = require('fs');
var path = require('path');
var mkdirp = require('mkdirp');

/**
 * Asynchronously writes data to a file, replacing the file if it already
 * exists and creating any intermediate directories if they don't already
 * exist. Data can be a string or a buffer. Returns a promise if a callback
 * function is not passed.
 *
 * ```js
 * var writeFile = require('write');
 * writeFile('foo.txt', 'This is content...', function(err) ***REMOVED***
 *   if (err) console.log(err);
 * ***REMOVED***);
 *
 * // promise
 * writeFile('foo.txt', 'This is content...')
 *   .then(function() ***REMOVED***
 *     // do stuff
 *   ***REMOVED***);
 * ```
 * @name writeFile
 * @param ***REMOVED***string|Buffer|integer***REMOVED*** `filepath` filepath or file descriptor.
 * @param ***REMOVED***string|Buffer|Uint8Array***REMOVED*** `data` String to write to disk.
 * @param ***REMOVED***object***REMOVED*** `options` Options to pass to [fs.writeFile][fs]***REMOVED***#fs_fs_writefile_file_data_options_callback***REMOVED*** and/or [mkdirp][]
 * @param ***REMOVED***Function***REMOVED*** `callback` (optional) If no callback is provided, a promise is returned.
 * @api public
 */

function writeFile(filepath, data, options, cb) ***REMOVED***
  if (typeof options === 'function') ***REMOVED***
    cb = options;
    options = ***REMOVED******REMOVED***;
  ***REMOVED***

  if (typeof cb !== 'function') ***REMOVED***
    return writeFile.promise.apply(null, arguments);
  ***REMOVED***

  if (typeof filepath !== 'string') ***REMOVED***
    cb(new TypeError('expected filepath to be a string'));
    return;
  ***REMOVED***

  mkdirp(path.dirname(filepath), options, function(err) ***REMOVED***
    if (err) ***REMOVED***
      cb(err);
      return;
    ***REMOVED***
    fs.writeFile(filepath, data, options, cb);
  ***REMOVED***);
***REMOVED***;

/**
 * The promise version of [writeFile](#writefile). Returns a promise.
 *
 * ```js
 * var writeFile = require('write');
 * writeFile.promise('foo.txt', 'This is content...')
 *   .then(function() ***REMOVED***
 *     // do stuff
 *   ***REMOVED***);
 * ```
 * @name .promise
 * @param ***REMOVED***string|Buffer|integer***REMOVED*** `filepath` filepath or file descriptor.
 * @param ***REMOVED***string|Buffer|Uint8Array***REMOVED*** `val` String or buffer to write to disk.
 * @param ***REMOVED***object***REMOVED*** `options` Options to pass to [fs.writeFile][fs]***REMOVED***#fs_fs_writefile_file_data_options_callback***REMOVED*** and/or [mkdirp][]
 * @return ***REMOVED***Promise***REMOVED***
 * @api public
 */

writeFile.promise = function(filepath, val, options) ***REMOVED***
  if (typeof filepath !== 'string') ***REMOVED***
    return Promise.reject(new TypeError('expected filepath to be a string'));
  ***REMOVED***

  return new Promise(function(resolve, reject) ***REMOVED***
    mkdirp(path.dirname(filepath), options, function(err) ***REMOVED***
      if (err) ***REMOVED***
        reject(err);
        return;
      ***REMOVED***

      fs.writeFile(filepath, val, options, function(err) ***REMOVED***
        if (err) ***REMOVED***
          reject(err);
          return;
        ***REMOVED***
        resolve(val);
      ***REMOVED***);
    ***REMOVED***);
  ***REMOVED***);
***REMOVED***;

/**
 * The synchronous version of [writeFile](#writefile). Returns undefined.
 *
 * ```js
 * var writeFile = require('write');
 * writeFile.sync('foo.txt', 'This is content...');
 * ```
 * @name .sync
 * @param ***REMOVED***string|Buffer|integer***REMOVED*** `filepath` filepath or file descriptor.
 * @param ***REMOVED***string|Buffer|Uint8Array***REMOVED*** `data` String or buffer to write to disk.
 * @param ***REMOVED***object***REMOVED*** `options` Options to pass to [fs.writeFileSync][fs]***REMOVED***#fs_fs_writefilesync_file_data_options***REMOVED*** and/or [mkdirp][]
 * @return ***REMOVED***undefined***REMOVED***
 * @api public
 */

writeFile.sync = function(filepath, data, options) ***REMOVED***
  if (typeof filepath !== 'string') ***REMOVED***
    throw new TypeError('expected filepath to be a string');
  ***REMOVED***
  mkdirp.sync(path.dirname(filepath), options);
  fs.writeFileSync(filepath, data, options);
***REMOVED***;

/**
 * Uses `fs.createWriteStream` to write data to a file, replacing the
 * file if it already exists and creating any intermediate directories
 * if they don't already exist. Data can be a string or a buffer. Returns
 * a new [WriteStream](https://nodejs.org/api/fs.html#fs_class_fs_writestream)
 * object.
 *
 * ```js
 * var fs = require('fs');
 * var writeFile = require('write');
 * fs.createReadStream('README.md')
 *   .pipe(writeFile.stream('a/b/c/other-file.md'))
 *   .on('close', function() ***REMOVED***
 *     // do stuff
 *   ***REMOVED***);
 * ```
 * @name .stream
 * @param ***REMOVED***string|Buffer|integer***REMOVED*** `filepath` filepath or file descriptor.
 * @param ***REMOVED***object***REMOVED*** `options` Options to pass to [mkdirp][] and [fs.createWriteStream][fs]***REMOVED***#fs_fs_createwritestream_path_options***REMOVED***
 * @return ***REMOVED***Stream***REMOVED*** Returns a new [WriteStream](https://nodejs.org/api/fs.html#fs_class_fs_writestream) object. (See [Writable Stream](https://nodejs.org/api/stream.html#stream_class_stream_writable)).
 * @api public
 */

writeFile.stream = function(filepath, options) ***REMOVED***
  mkdirp.sync(path.dirname(filepath), options);
  return fs.createWriteStream(filepath, options);
***REMOVED***;

/**
 * Expose `writeFile`
 */

module.exports = writeFile;
