'use strict';
const errorEx = require('error-ex');
const fallback = require('json-parse-better-errors');

const JSONError = errorEx('JSONError', ***REMOVED***
	fileName: errorEx.append('in %s')
***REMOVED***);

module.exports = (input, reviver, filename) => ***REMOVED***
	if (typeof reviver === 'string') ***REMOVED***
		filename = reviver;
		reviver = null;
	***REMOVED***

	try ***REMOVED***
		try ***REMOVED***
			return JSON.parse(input, reviver);
		***REMOVED*** catch (err) ***REMOVED***
			fallback(input, reviver);

			throw err;
		***REMOVED***
	***REMOVED*** catch (err) ***REMOVED***
		err.message = err.message.replace(/\n/g, '');

		const jsonErr = new JSONError(err);
		if (filename) ***REMOVED***
			jsonErr.fileName = filename;
		***REMOVED***

		throw jsonErr;
	***REMOVED***
***REMOVED***;
