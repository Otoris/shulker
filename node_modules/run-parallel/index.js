module.exports = runParallel

function runParallel (tasks, cb) ***REMOVED***
  var results, pending, keys
  var isSync = true

  if (Array.isArray(tasks)) ***REMOVED***
    results = []
    pending = tasks.length
  ***REMOVED*** else ***REMOVED***
    keys = Object.keys(tasks)
    results = ***REMOVED******REMOVED***
    pending = keys.length
  ***REMOVED***

  function done (err) ***REMOVED***
    function end () ***REMOVED***
      if (cb) cb(err, results)
      cb = null
    ***REMOVED***
    if (isSync) process.nextTick(end)
    else end()
  ***REMOVED***

  function each (i, err, result) ***REMOVED***
    results[i] = result
    if (--pending === 0 || err) ***REMOVED***
      done(err)
    ***REMOVED***
  ***REMOVED***

  if (!pending) ***REMOVED***
    // empty
    done(null)
  ***REMOVED*** else if (keys) ***REMOVED***
    // object
    keys.forEach(function (key) ***REMOVED***
      tasks[key](function (err, result) ***REMOVED*** each(key, err, result) ***REMOVED***)
    ***REMOVED***)
  ***REMOVED*** else ***REMOVED***
    // array
    tasks.forEach(function (task, i) ***REMOVED***
      task(function (err, result) ***REMOVED*** each(i, err, result) ***REMOVED***)
    ***REMOVED***)
  ***REMOVED***

  isSync = false
***REMOVED***
